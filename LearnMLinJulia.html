<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>6e7e76f2b8774592814bed25f25925ee</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="210b3af8" class="cell markdown">
<h1 id="machine-learning-in-julia">Machine Learning in Julia</h1>
</div>
<div id="75a45be4" class="cell markdown">
<h2 id="using-mlb-player-data">Using MLB Player Data</h2>
</div>
<div id="56dc16a7" class="cell markdown">
<p>The purpose of this notebook is to explore machine learning in Julia.
The goal is to train a model that will take a team's yearly stats kept
track of in the boxscore to predict the number of games that the team
will win in that year.</p>
</div>
<div id="c6cab741" class="cell markdown">
<h3 id="load-in-data">Load in Data</h3>
</div>
<div id="4af8d2b6" class="cell markdown">
<p>The data used for this project is from Lahman's Database, which
provides yearly box score stats for each individual player, team, and
park in the MLB. This database provides several datasets that could be
used for this analysis. The first option is a dataset for the team's
yearly stats with 25 features, and the second is taking the player's
yearly stats from fielding, batting, and pitching datasets and
aggregating them. For our purposes, the second option will be used as it
results in around 40 features and because it gives further exposure to
data wrangling. The data is loaded below with some wrangling to change
the names of some of the teams as they have changed their name, but are
one constant franchise (for example, the Miami Marlins were the Florida
Marlins before rebranding). Additionally, the year is limited to only
going as far back as 1965. This is for our model to better predict wins
as games played reached its current format in 1962.</p>
</div>
<div id="9e8df509" class="cell code" data-execution_count="323">
<div class="sourceCode" id="cb1"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CSV</span>, <span class="bu">DataFrames</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>Bat <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">&quot;/Users/jackmerchen/Data/baseballdatabank-2022.2/core/Batting.csv&quot;</span>, DataFrame)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>Pitch <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">&quot;/Users/jackmerchen/Data/baseballdatabank-2022.2/core/Pitching.csv&quot;</span>, DataFrame)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>Field <span class="op">=</span> CSV.<span class="fu">read</span>(<span class="st">&quot;/Users/jackmerchen/Data/baseballdatabank-2022.2/core/Fielding.csv&quot;</span>, DataFrame)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>Value_map <span class="op">=</span> <span class="fu">Dict</span>(<span class="st">&quot;BAL&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;BAL&quot;</span>, <span class="st">&quot;CHA&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;CWS&quot;</span>, <span class="st">&quot;CHN&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;CHC&quot;</span>, <span class="st">&quot;FLO&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;FLA&quot;</span>, <span class="st">&quot;KC1&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;KCR&quot;</span>, <span class="st">&quot;LAN&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;LAD&quot;</span>, <span class="st">&quot;ML1&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;MLN&quot;</span>, <span class="st">&quot;ML4&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;MLN&quot;</span>, <span class="st">&quot;NYA&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;NYY&quot;</span>, <span class="st">&quot;NYN&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;NYM&quot;</span>, <span class="st">&quot;SDN&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;SDP&quot;</span>, <span class="st">&quot;SE1&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;SEP&quot;</span>, <span class="st">&quot;SFN&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;SFG&quot;</span>, <span class="st">&quot;SLN&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;STL&quot;</span>, <span class="st">&quot;TBA&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;TBR&quot;</span>, <span class="st">&quot;WAS&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;WSH&quot;</span>, <span class="st">&quot;WS1&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;WSA&quot;</span>, <span class="st">&quot;WS2&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;WSN&quot;</span>, <span class="st">&quot;DET&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;DET&quot;</span>, <span class="st">&quot;CLE&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;CLE&quot;</span>, <span class="st">&quot;MIN&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;MIN&quot;</span>, <span class="st">&quot;PHI&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;PHI&quot;</span>, <span class="st">&quot;CIN&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;CIN&quot;</span>, <span class="st">&quot;LAA&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;LAA&quot;</span>, <span class="st">&quot;PIT&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;PIT&quot;</span>, <span class="st">&quot;BOS&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;BOS&quot;</span>, <span class="st">&quot;HOU&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;HOU&quot;</span>, <span class="st">&quot;CAL&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;LAA&quot;</span>, <span class="st">&quot;ATL&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;ATL&quot;</span>, <span class="st">&quot;OAK&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;OAK&quot;</span>, <span class="st">&quot;KCA&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;KCR&quot;</span>, <span class="st">&quot;MON&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;MON&quot;</span>, <span class="st">&quot;TEX&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;TEX&quot;</span>, <span class="st">&quot;SEA&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;SEA&quot;</span>, <span class="st">&quot;TOR&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;TOR&quot;</span>, <span class="st">&quot;COL&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;COL&quot;</span>, <span class="st">&quot;ANA&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;LAA&quot;</span>, <span class="st">&quot;ARI&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;ARI&quot;</span>, <span class="st">&quot;MIL&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;MIL&quot;</span>, <span class="st">&quot;MIA&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;MIA&quot;</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>Bat <span class="op">=</span> <span class="fu">filter</span>(Bat <span class="op">-&gt;</span> Bat.yearID <span class="op">&gt;</span> <span class="fl">1964</span>, Bat)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>Bat[!, <span class="st">&quot;teamID&quot;</span>] <span class="op">=</span> [Value_map[item] for item <span class="kw">in</span> Bat[!, <span class="st">&quot;teamID&quot;</span>]]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>Bat <span class="op">=</span> <span class="fu">select!</span>(Bat, <span class="fu">Not</span>([<span class="st">&quot;playerID&quot;</span>, <span class="st">&quot;stint&quot;</span>, <span class="st">&quot;lgID&quot;</span>, <span class="st">&quot;G&quot;</span>]))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>Pitch <span class="op">=</span> <span class="fu">filter</span>(Pitch <span class="op">-&gt;</span> Pitch.yearID <span class="op">&gt;</span> <span class="fl">1964</span>, Pitch)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>Pitch[!, <span class="st">&quot;teamID&quot;</span>] <span class="op">=</span> [Value_map[item] for item <span class="kw">in</span> Pitch[!, <span class="st">&quot;teamID&quot;</span>]]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>Pitch <span class="op">=</span> <span class="fu">select!</span>(Pitch, <span class="fu">Not</span>([<span class="st">&quot;playerID&quot;</span>, <span class="st">&quot;stint&quot;</span>, <span class="st">&quot;lgID&quot;</span>, <span class="st">&quot;ERA&quot;</span>, <span class="st">&quot;BAOpp&quot;</span>, <span class="st">&quot;L&quot;</span>]))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>Field <span class="op">=</span> <span class="fu">filter</span>(Field <span class="op">-&gt;</span> Field.yearID <span class="op">&gt;</span> <span class="fl">1964</span>, Field)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>Field[!, <span class="st">&quot;teamID&quot;</span>] <span class="op">=</span> [Value_map[item] for item <span class="kw">in</span> Field[!, <span class="st">&quot;teamID&quot;</span>]]</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(Field)</span></code></pre></div>
<div class="output execute_result" data-execution_count="323">
<p>DataFrameRow (18 columns)</p><div class="data-frame"><table class="data-frame"><thead><tr><th></th><th>playerID</th><th>yearID</th><th>stint</th><th>teamID</th><th>lgID</th><th>POS</th><th>G</th><th>GS</th><th>InnOuts</th><th>PO</th></tr><tr><th></th><th title="String15">String15</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="String">String</th><th title="String3">String3</th><th title="String3">String3</th><th title="Int64">Int64</th><th title="Union{Missing, Int64}">Int64?</th><th title="Union{Missing, Int64}">Int64?</th><th title="Int64">Int64</th></tr></thead><tbody><tr><th>1</th><td>aaronha01</td><td>1965</td><td>1</td><td>MLN</td><td>NL</td><td>OF</td><td>148</td><td>148</td><td>3928</td><td>298</td></tr></tbody></table></div>
</div>
</div>
<div id="a7542be1" class="cell markdown">
<h3 id="split-apply-combine">Split-Apply-Combine</h3>
</div>
<div id="c585544d" class="cell markdown">
<p>Finding the yearly aggregates based off player stats means grouping
by both team and year and then finding the aggregates. In R, this is as
simple as using Dplyr's group_by, piping, and summarise, but is not so
simple in Julia. In Julia, the groupby function creates a new table for
each group found. This means using the method of Split-Apply-Combine to
get the desired output. The groupby function accomplishes the split
portion of this method. Next, in the apply portion, we just grap the
names of the columns as opposed to applying other functions to the
groups. Then, in the combine portion, we combine the different groups
into a single dataset again, with the columns containing data being
summed. This gives the yearly aggregates for one of the datasets. This
method is applied to each the batting, fielding, and pitching stats, as
seen below.</p>
</div>
<div id="9cc1d11a" class="cell code" data-execution_count="324">
<div class="sourceCode" id="cb2"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>grp <span class="op">=</span> <span class="fu">groupby</span>(Bat, [<span class="st">&quot;teamID&quot;</span>, <span class="st">&quot;yearID&quot;</span>])</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="fu">names</span>(grp)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>data_cols <span class="op">=</span> cols[<span class="fl">3</span><span class="op">:</span><span class="kw">end</span>]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>bdf <span class="op">=</span> <span class="fu">combine</span>(grp, data_cols <span class="op">.=&gt;</span> sum <span class="op">.=&gt;</span> data_cols)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>bdf[!, <span class="op">:</span>Ave] <span class="op">=</span> bdf[!, <span class="op">:</span>H] <span class="op">./</span> bdf[!, <span class="op">:</span>AB]</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>bdf[!, <span class="op">:</span>TB] <span class="op">=</span> bdf[!, <span class="op">:</span>H] <span class="op">.-</span> bdf[!, <span class="st">&quot;2B&quot;</span>] <span class="op">.-</span> bdf[!, <span class="st">&quot;3B&quot;</span>] <span class="op">.-</span> bdf[!, <span class="op">:</span>HR] <span class="op">.+</span> bdf[!, <span class="st">&quot;2B&quot;</span>] <span class="op">.*</span> <span class="fl">2</span> <span class="op">.+</span> bdf[!, <span class="st">&quot;3B&quot;</span>] <span class="op">.*</span> <span class="fl">3</span> <span class="op">.+</span> bdf[!, <span class="op">:</span>HR] <span class="op">.*</span> <span class="fl">4</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(bdf, <span class="fl">5</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="324">
<div class="data-frame"><p>5 rows × 20 columns (omitted printing of 8 columns)</p><table class="data-frame"><thead><tr><th></th><th>teamID</th><th>yearID</th><th>AB</th><th>R</th><th>H</th><th>2B</th><th>3B</th><th>HR</th><th>RBI</th><th>SB</th><th>CS</th><th>BB</th></tr><tr><th></th><th title="String">String</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th></tr></thead><tbody><tr><th>1</th><td>MLN</td><td>1965</td><td>5542</td><td>708</td><td>1419</td><td>243</td><td>28</td><td>196</td><td>664</td><td>64</td><td>37</td><td>408</td></tr><tr><th>2</th><td>CHC</td><td>1965</td><td>5540</td><td>635</td><td>1316</td><td>202</td><td>33</td><td>134</td><td>590</td><td>65</td><td>47</td><td>532</td></tr><tr><th>3</th><td>BAL</td><td>1965</td><td>5450</td><td>641</td><td>1299</td><td>227</td><td>38</td><td>125</td><td>596</td><td>67</td><td>31</td><td>529</td></tr><tr><th>4</th><td>LAA</td><td>1965</td><td>5354</td><td>527</td><td>1279</td><td>200</td><td>36</td><td>92</td><td>486</td><td>107</td><td>59</td><td>443</td></tr><tr><th>5</th><td>HOU</td><td>1965</td><td>5483</td><td>569</td><td>1299</td><td>188</td><td>42</td><td>97</td><td>523</td><td>90</td><td>37</td><td>502</td></tr></tbody></table></div>
</div>
</div>
<div id="69d6f0ec" class="cell code" data-execution_count="325">
<div class="sourceCode" id="cb3"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>grp <span class="op">=</span> <span class="fu">groupby</span>(Pitch, [<span class="st">&quot;teamID&quot;</span>, <span class="st">&quot;yearID&quot;</span>])</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="fu">names</span>(grp)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>data_cols <span class="op">=</span> cols[<span class="fl">3</span><span class="op">:</span><span class="kw">end</span>]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>pdf <span class="op">=</span> <span class="fu">combine</span>(grp, data_cols <span class="op">.=&gt;</span> sum <span class="op">.=&gt;</span> data_cols)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>pdf[!, <span class="op">:</span>ERA] <span class="op">=</span> pdf[!, <span class="op">:</span>ER] <span class="op">.*</span> <span class="fl">27</span> <span class="op">./</span> pdf[!, <span class="op">:</span>IPouts]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rename!</span>(pdf, <span class="op">:</span>HR <span class="op">=&gt;</span> <span class="op">:</span>HR_opp, <span class="op">:</span>BB <span class="op">=&gt;</span> <span class="op">:</span>BB_opp, <span class="op">:</span>SO <span class="op">=&gt;</span> <span class="op">:</span>SO_opp, <span class="op">:</span>IBB <span class="op">=&gt;</span> <span class="op">:</span>IBB_opp, <span class="op">:</span>HBP <span class="op">=&gt;</span> <span class="op">:</span>HBP_opp, <span class="op">:</span>R <span class="op">=&gt;</span> <span class="op">:</span>R_opp, <span class="op">:</span>SH <span class="op">=&gt;</span> <span class="op">:</span>SH_opp, <span class="op">:</span>SF <span class="op">=&gt;</span> <span class="op">:</span>SF_opp, <span class="op">:</span>GIDP <span class="op">=&gt;</span> <span class="op">:</span>GIDP_opp, <span class="op">:</span>H <span class="op">=&gt;</span> <span class="op">:</span>H_opp)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(pdf, <span class="fl">5</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="325">
<div class="data-frame"><p>5 rows × 25 columns (omitted printing of 14 columns)</p><table class="data-frame"><thead><tr><th></th><th>teamID</th><th>yearID</th><th>W</th><th>G</th><th>GS</th><th>CG</th><th>SHO</th><th>SV</th><th>IPouts</th><th>H_opp</th><th>ER</th></tr><tr><th></th><th title="String">String</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th></tr></thead><tbody><tr><th>1</th><td>CHC</td><td>1965</td><td>72</td><td>456</td><td>164</td><td>33</td><td>8</td><td>35</td><td>4416</td><td>1470</td><td>618</td></tr><tr><th>2</th><td>DET</td><td>1965</td><td>89</td><td>402</td><td>162</td><td>45</td><td>12</td><td>31</td><td>4365</td><td>1283</td><td>542</td></tr><tr><th>3</th><td>KCR</td><td>1965</td><td>59</td><td>540</td><td>162</td><td>18</td><td>6</td><td>32</td><td>4299</td><td>1399</td><td>675</td></tr><tr><th>4</th><td>SFG</td><td>1965</td><td>95</td><td>425</td><td>163</td><td>42</td><td>11</td><td>42</td><td>4396</td><td>1325</td><td>521</td></tr><tr><th>5</th><td>HOU</td><td>1965</td><td>65</td><td>418</td><td>162</td><td>29</td><td>7</td><td>26</td><td>4383</td><td>1459</td><td>624</td></tr></tbody></table></div>
</div>
</div>
<div id="fb747232" class="cell code" data-execution_count="326">
<div class="sourceCode" id="cb4"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select!</span>(Field, <span class="fu">Not</span>([<span class="st">&quot;playerID&quot;</span>, <span class="st">&quot;stint&quot;</span>, <span class="st">&quot;lgID&quot;</span>, <span class="st">&quot;POS&quot;</span>, <span class="st">&quot;G&quot;</span>, <span class="st">&quot;GS&quot;</span>, <span class="st">&quot;DP&quot;</span>, <span class="st">&quot;PB&quot;</span>, <span class="st">&quot;WP&quot;</span>, <span class="st">&quot;ZR&quot;</span>, <span class="st">&quot;InnOuts&quot;</span>, <span class="st">&quot;SB&quot;</span>, <span class="st">&quot;CS&quot;</span>]))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>grp <span class="op">=</span> <span class="fu">groupby</span>(Field, [<span class="st">&quot;teamID&quot;</span>, <span class="st">&quot;yearID&quot;</span>])</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="fu">names</span>(grp)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>data_cols <span class="op">=</span> cols[<span class="fl">3</span><span class="op">:</span><span class="kw">end</span>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>fdf <span class="op">=</span> <span class="fu">combine</span>(grp, data_cols <span class="op">.=&gt;</span> sum <span class="op">.=&gt;</span> data_cols)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>fdf[!, <span class="op">:</span>ERPer] <span class="op">=</span> fdf[!, <span class="op">:</span>E] <span class="op">./</span> fdf[!, <span class="op">:</span>PO]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(fdf, <span class="fl">5</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="326">
<div class="data-frame"><p>5 rows × 6 columns</p><table class="data-frame"><thead><tr><th></th><th>teamID</th><th>yearID</th><th>PO</th><th>A</th><th>E</th><th>ERPer</th></tr><tr><th></th><th title="String">String</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Int64">Int64</th><th title="Float64">Float64</th></tr></thead><tbody><tr><th>1</th><td>MLN</td><td>1965</td><td>4345</td><td>1742</td><td>140</td><td>0.0322209</td></tr><tr><th>2</th><td>CHC</td><td>1965</td><td>4416</td><td>2004</td><td>171</td><td>0.0387228</td></tr><tr><th>3</th><td>BAL</td><td>1965</td><td>4411</td><td>1770</td><td>126</td><td>0.028565</td></tr><tr><th>4</th><td>LAA</td><td>1965</td><td>4330</td><td>1868</td><td>123</td><td>0.0284065</td></tr><tr><th>5</th><td>HOU</td><td>1965</td><td>4384</td><td>1762</td><td>166</td><td>0.037865</td></tr></tbody></table></div>
</div>
</div>
<div id="984f3b58" class="cell markdown">
<h3 id="join">Join</h3>
</div>
<div id="7f6faefd" class="cell markdown">
<p>After the aggregates are found for each of the separate datasets,
they can then be combined into a single dataset again using a join on
both year and team. The columns of the final dataset that will be used
in the training of the model can be seen below.</p>
</div>
<div id="d8e67f31" class="cell code" data-execution_count="640">
<div class="sourceCode" id="cb5"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">CSV</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="fu">leftjoin</span>(bdf, pdf, on <span class="op">=</span> [<span class="op">:</span>teamID, <span class="op">:</span>yearID])</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="fu">leftjoin</span>(df, fdf, on <span class="op">=</span> [<span class="op">:</span>teamID, <span class="op">:</span>yearID])</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">replace!</span>(df.SH_opp, <span class="cn">missing</span> <span class="op">=&gt;</span> <span class="fl">0</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">replace!</span>(df.SF_opp, <span class="cn">missing</span> <span class="op">=&gt;</span> <span class="fl">0</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">replace!</span>(df.GIDP_opp, <span class="cn">missing</span> <span class="op">=&gt;</span> <span class="fl">0</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="fu">names</span>(df))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#CSV.write(&quot;/Users/jackmerchen/Data/Year_Baseball.csv&quot;, df)</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>[&quot;teamID&quot;, &quot;yearID&quot;, &quot;AB&quot;, &quot;R&quot;, &quot;H&quot;, &quot;2B&quot;, &quot;3B&quot;, &quot;HR&quot;, &quot;RBI&quot;, &quot;SB&quot;, &quot;CS&quot;, &quot;BB&quot;, &quot;SO&quot;, &quot;IBB&quot;, &quot;HBP&quot;, &quot;SH&quot;, &quot;SF&quot;, &quot;GIDP&quot;, &quot;Ave&quot;, &quot;TB&quot;, &quot;W&quot;, &quot;G&quot;, &quot;GS&quot;, &quot;CG&quot;, &quot;SHO&quot;, &quot;SV&quot;, &quot;IPouts&quot;, &quot;H_opp&quot;, &quot;ER&quot;, &quot;HR_opp&quot;, &quot;BB_opp&quot;, &quot;SO_opp&quot;, &quot;IBB_opp&quot;, &quot;WP&quot;, &quot;HBP_opp&quot;, &quot;BK&quot;, &quot;BFP&quot;, &quot;GF&quot;, &quot;R_opp&quot;, &quot;SH_opp&quot;, &quot;SF_opp&quot;, &quot;GIDP_opp&quot;, &quot;ERA&quot;, &quot;PO&quot;, &quot;A&quot;, &quot;E&quot;, &quot;ERPer&quot;]
</code></pre>
</div>
</div>
<div id="e2190a39" class="cell markdown">
<h3 id="train--test--split">Train — Test — Split</h3>
</div>
<div id="c9ee22ed" class="cell markdown">
<p>Now that the data has been combined into a single dataset, we are
ready to break it up again. The data will be randomly split into two
datasets, one to train the model on, and that the model has not seen yet
that will be used to test the effectiveness of the model. Splitting the
model into a training set with 80% of the data will give us 1192
instances to train our model on and 298 to test the model on (before
this was done, both the 1994 and 2020 seasons were excluded as both were
shortened seasons). Each of these datasets is then split into a dataset
containing features and another containing the target (Wins).</p>
</div>
<div id="2bb45cc7" class="cell code" data-execution_count="645">
<div class="sourceCode" id="cb7"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MultivariateStats</span>, <span class="bu">RDatasets</span>, <span class="bu">DataFrames</span>, <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter!</span>(df <span class="op">-&gt;</span> df.yearID <span class="op">!=</span> <span class="fl">2020</span>, df)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter!</span>(df <span class="op">-&gt;</span> df.yearID <span class="op">!=</span> <span class="fl">1994</span>, df)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#select!(df, Not([&quot;G&quot;, &quot;SV&quot;, &quot;SHO&quot;]))</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">splitdf</span>(df, pct)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@assert</span> <span class="fl">0</span> <span class="op">&lt;=</span> pct <span class="op">&lt;=</span> <span class="fl">1</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    ids <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">axes</span>(df, <span class="fl">1</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">shuffle!</span>(ids)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    per <span class="op">=</span> ids <span class="op">.&lt;=</span> <span class="fu">nrow</span>(df) <span class="op">.*</span> pct</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> <span class="fu">view</span>(df, per, <span class="op">:</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    train <span class="op">=</span> <span class="fu">view</span>(df, .!per, <span class="op">:</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> test, train</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>train, test <span class="op">=</span> <span class="fu">splitdf</span>(df, <span class="fl">.8</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>train_lab <span class="op">=</span> train[<span class="op">:</span>, <span class="op">:</span>W]</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>train_hold <span class="op">=</span> <span class="fu">select</span>(train, <span class="fu">Not</span>([<span class="st">&quot;teamID&quot;</span>, <span class="st">&quot;yearID&quot;</span>, <span class="st">&quot;W&quot;</span>]))</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> <span class="fu">Matrix</span>(<span class="fu">Float32</span>.(train_hold))</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>train_lab <span class="op">=</span> <span class="fu">Float32</span>.(train_lab)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> <span class="fu">select</span>(test, <span class="fu">Not</span>([<span class="st">&quot;teamID&quot;</span>, <span class="st">&quot;yearID&quot;</span>, <span class="st">&quot;W&quot;</span>]))</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> <span class="fu">Matrix</span>(<span class="fu">Float32</span>.(test_df))</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>test_lab <span class="op">=</span> <span class="fu">Float32</span>.(test[<span class="op">:</span>, <span class="op">:</span>W])</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>train_df</span></code></pre></div>
<div class="output execute_result" data-execution_count="645">
<pre><code>1192×44 Matrix{Float32}:
 5542.0  708.0  1419.0  243.0  28.0  …  4345.0  1742.0  140.0  0.0322209
 5540.0  635.0  1316.0  202.0  33.0     4416.0  2004.0  171.0  0.0387228
 5450.0  641.0  1299.0  227.0  38.0     4411.0  1770.0  126.0  0.028565
 5354.0  527.0  1279.0  200.0  36.0     4330.0  1868.0  123.0  0.0284065
 5483.0  569.0  1299.0  188.0  42.0     4384.0  1762.0  166.0  0.037865
 5509.0  647.0  1354.0  200.0  38.0  …  4436.0  1938.0  127.0  0.0286294
 5368.0  680.0  1278.0  190.0  27.0     4358.0  1591.0  116.0  0.0266177
 5393.0  585.0  1294.0  186.0  59.0     4300.0  1620.0  139.0  0.0323256
 5488.0  774.0  1396.0  257.0  42.0     4366.0  1770.0  172.0  0.0393953
 5686.0  675.0  1506.0  217.0  57.0     4437.0  1977.0  152.0  0.0342574
 5495.0  682.0  1384.0  169.0  43.0  …  4396.0  1706.0  148.0  0.033667
 5469.0  663.0  1367.0  198.0  21.0     4366.0  1574.0  114.0  0.0261109
 5374.0  591.0  1227.0  179.0  33.0     4292.0  1646.0  143.0  0.0333178
    ⋮                                ⋱     ⋮                   
 5348.0  623.0  1244.0  226.0  23.0  …  4245.0  1444.0  122.0  0.0287397
 5423.0  786.0  1352.0  295.0  13.0     4303.0  1422.0   91.0  0.021148
 5431.0  729.0  1311.0  271.0  17.0     4258.0  1420.0  107.0  0.0251292
 5445.0  830.0  1330.0  247.0  24.0     4356.0  1303.0   89.0  0.0204316
 5376.0  697.0  1299.0  236.0  37.0     4259.0  1492.0   83.0  0.0194881
 5405.0  625.0  1254.0  225.0  24.0  …  4273.0  1462.0   83.0  0.0194243
 5336.0  609.0  1261.0  240.0  35.0     4189.0  1378.0   70.0  0.0167104
 5210.0  636.0  1243.0  228.0  18.0     4138.0  1312.0   95.0  0.022958
 5462.0  804.0  1360.0  271.0  25.0     4365.0  1471.0   80.0  0.0183276
 5366.0  734.0  1288.0  262.0  24.0     4256.0  1439.0   94.0  0.0220865
 5355.0  697.0  1209.0  233.0  11.0  …  4321.0  1384.0   79.0  0.0182828
 5351.0  706.0  1303.0  261.0  22.0     4251.0  1514.0   84.0  0.0197601</code></pre>
</div>
</div>
<div id="213a904b" class="cell markdown">
<p>The model used is a extreme gradient boosted model from the XGBoost
package. This model, after training, was then used to predict wins and
measured using Mean Squared Error. The Root Mean Squared Error for the
model was just over 4, meaning that, on average, the predictions for the
wins was withing 5 games.</p>
</div>
<div id="12ee557d" class="cell code" data-execution_count="646">
<div class="sourceCode" id="cb9"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">XGBoost</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>dmat <span class="op">=</span> XGBoost.<span class="fu">DMatrix</span>(train_df, label <span class="op">=</span> train_lab)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> <span class="fu">Dict</span>(<span class="st">&quot;max_depth&quot;</span> <span class="op">=&gt;</span> <span class="fl">3</span>, <span class="st">&quot;eta&quot;</span> <span class="op">=&gt;</span> <span class="fl">0.1</span>, <span class="st">&quot;objective&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;reg:squarederror&quot;</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>num_round <span class="op">=</span> <span class="fl">20</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>dtest <span class="op">=</span> XGBoost.<span class="fu">DMatrix</span>(test_df, label <span class="op">=</span> test_lab)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>evals <span class="op">=</span> [(dmat, <span class="st">&quot;train&quot;</span>), (dtest, <span class="st">&quot;test&quot;</span>)]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> XGBoost.<span class="fu">xgboost</span>(dmat, num_round; params)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>[1]	train-rmse:56.86199396701842801
[2]	train-rmse:40.18185819106857082
[3]	train-rmse:28.44061721584919056
[4]	train-rmse:20.24998649051805799
[5]	train-rmse:14.50663954081389484
[6]	train-rmse:10.49224128029195313
[7]	train-rmse:7.71404966473369225
[8]	train-rmse:5.80855581382417885
[9]	train-rmse:4.49480433605527629
[10]	train-rmse:3.56710144648384020
[11]	train-rmse:2.99874413210618629
[12]	train-rmse:2.62628584400327947
[13]	train-rmse:2.37056012889610246
[14]	train-rmse:2.19640022237753163
[15]	train-rmse:2.00324216663417332
[16]	train-rmse:1.92352682326846747
[17]	train-rmse:1.81552948050350160
[18]	train-rmse:1.72157833330610521
[19]	train-rmse:1.68412300517385538
[20]	train-rmse:1.60398860334257387
</code></pre>
</div>
<div class="output execute_result" data-execution_count="646">
<pre><code>Booster(Ptr{Nothing} @0x00007fadf54b23e0)</code></pre>
</div>
</div>
<div id="09e8b715" class="cell code" data-execution_count="648">
<div class="sourceCode" id="cb12"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> XGBoost.<span class="fu">predict</span>(mod, dtest)</span></code></pre></div>
<div class="output execute_result" data-execution_count="648">
<pre><code>298-element Vector{Float32}:
 80.47774
 82.215385
 54.360874
 89.07074
 78.16156
 87.38355
 93.943146
 80.6992
 90.69626
 89.33131
 93.213646
 76.00728
 60.75884
  ⋮
 47.504807
 75.7301
 73.76408
 84.96909
 76.60711
 64.17861
 69.88752
 82.239075
 57.13357
 68.83273
 78.93254
 86.75327</code></pre>
</div>
</div>
<div id="7339d32c" class="cell code" data-execution_count="661">
<div class="sourceCode" id="cb14"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">MLJBase</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">rmse</span>(y_pred<span class="op">::</span><span class="dt">AbstractArray</span>, y_true<span class="op">::</span><span class="dt">AbstractArray</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sqrt</span>(<span class="fu">sum</span>((y_pred <span class="op">.-</span> y_true)<span class="op">.^</span><span class="fl">2</span>) <span class="op">/</span> <span class="fu">length</span>(y_pred))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>MSE <span class="op">=</span> <span class="fu">rmse</span>(preds, test_lab)</span></code></pre></div>
<div class="output execute_result" data-execution_count="661">
<pre><code>4.323124f0</code></pre>
</div>
</div>
<div id="b0bae2ee" class="cell code" data-execution_count="663">
<div class="sourceCode" id="cb16"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Plots</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(x) <span class="op">=</span> x</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(<span class="fu">scatter</span>(test_lab, preds), title <span class="op">=</span> <span class="st">&quot;Actual Versus Predicted Wins&quot;</span>, xlabel <span class="op">=</span> <span class="st">&quot;Actual&quot;</span>, ylab <span class="op">=</span> <span class="st">&quot;Predicted&quot;</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(f, <span class="fl">40</span>, <span class="fl">110</span>, label <span class="op">=</span> <span class="st">&quot;Actual = Predicted&quot;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="663">
<p><img
src="vertopal_58b046e6ee5f4e2db3955e6036e9c6c3/e86c3107bc9df746de77608b3768ddca0d861d8b.svg" /></p>
</div>
</div>
<div id="e36eeaeb" class="cell markdown">
<h3 id="feature-importance">Feature Importance</h3>
</div>
<div id="5a09d717" class="cell markdown">
<p>Measuring importance of features offers insight into our model that
can be used for the real-world by allowing us insight into which
features are the most important in predicting wins. It would allow, for
example, for a team to know which feature should too be important to
them. Using the built-in importance function yields the results below.
Unsurprisingly, runs scored, ERA, and earned runs are the top three
features in importance. So, you need to score more runs than you allow,
which is intuitive. This method of importance, however, shows that hits,
doubles, triples, and homeruns (f2, f3, f4, and f5, respectively), are
unimportant features, but that total bases touched is more important.
This is due to double counting these features as each is used in the
calculation of total bases touched. Looking at the correlations for each
feature (below the next two code boxes), shows that each (except
triples) is strongly correlated to wins. Looking at correlation shows
that hits and even walks is as strongly correlated as ERA.</p>
</div>
<div id="b7d9c00f" class="cell code" data-execution_count="676">
<div class="sourceCode" id="cb17"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> <span class="fu">DataFrame</span>(XGBoost.<span class="fu">importance</span>(mod))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(scores, allrows <span class="op">=</span> <span class="cn">true</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>44×4 DataFrame
 Row │ fname   gain         cover       freq       
     │ String  Float64      Float64     Float64    
─────┼─────────────────────────────────────────────
   1 │ f1      0.308073     0.123187    0.0729167
   2 │ f35     0.201676     0.0636664   0.0386905
   3 │ f22     0.170092     0.118941    0.0550595
   4 │ f39     0.127795     0.0672086   0.0372024
   5 │ f6      0.0388091    0.049343    0.0357143
   6 │ f40     0.0369852    0.00639603  0.0014881
   7 │ f21     0.0186646    0.0287705   0.0178571
   8 │ f17     0.0182916    0.00586238  0.0104167
   9 │ f28     0.00808123   0.0140372   0.0193452
  10 │ f9      0.00663741   0.0492502   0.0386905
  11 │ f18     0.00436627   0.0131556   0.0193452
  12 │ f20     0.00426411   0.0225214   0.0238095
  13 │ f11     0.00415272   0.0294434   0.016369
  14 │ f25     0.00368765   0.00743239  0.014881
  15 │ f27     0.00355813   0.0200311   0.0267857
  16 │ f29     0.00349311   0.0341225   0.0267857
  17 │ f23     0.00310188   0.0262647   0.0223214
  18 │ f16     0.00305015   0.0384767   0.0267857
  19 │ f0      0.0023752    0.0221193   0.09375
  20 │ f33     0.00229351   0.0129854   0.0133929
  21 │ f15     0.00189972   0.0130473   0.0223214
  22 │ f13     0.00186655   0.0293042   0.0208333
  23 │ f14     0.00174932   0.00637283  0.0193452
  24 │ f2      0.00154389   0.00682913  0.0119048
  25 │ f3      0.00154139   0.00692967  0.0267857
  26 │ f42     0.00150963   0.0105183   0.0133929
  27 │ f8      0.00147177   0.0166745   0.0223214
  28 │ f26     0.00146899   0.00351898  0.016369
  29 │ f43     0.00146463   0.0223977   0.0133929
  30 │ f41     0.00141974   0.0121192   0.0208333
  31 │ f36     0.00141235   0.0112221   0.0193452
  32 │ f24     0.00137463   0.00651204  0.016369
  33 │ f7      0.00134261   0.0206498   0.0223214
  34 │ f37     0.00129879   0.00409129  0.016369
  35 │ f31     0.00128959   0.00904879  0.0223214
  36 │ f34     0.00121031   0.0123048   0.00892857
  37 │ f5      0.00111918   0.00600933  0.0119048
  38 │ f4      0.00101637   0.00234341  0.016369
  39 │ f10     0.000896114  0.00353444  0.0104167
  40 │ f30     0.000876429  0.0218254   0.0133929
  41 │ f12     0.000865693  0.00525913  0.0178571
  42 │ f19     0.000803265  0.00294666  0.00892857
  43 │ f38     0.000670268  0.00200311  0.0104167
  44 │ f32     0.000439914  0.0113226   0.00595238</code></pre>
</div>
</div>
<div id="dc5e45da" class="cell code" data-execution_count="665">
<div class="sourceCode" id="cb19"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(<span class="fu">names</span>(train_hold))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[&quot;AB&quot;, &quot;R&quot;, &quot;H&quot;, &quot;2B&quot;, &quot;3B&quot;, &quot;HR&quot;, &quot;RBI&quot;, &quot;SB&quot;, &quot;CS&quot;, &quot;BB&quot;, &quot;SO&quot;, &quot;IBB&quot;, &quot;HBP&quot;, &quot;SH&quot;, &quot;SF&quot;, &quot;GIDP&quot;, &quot;Ave&quot;, &quot;TB&quot;, &quot;G&quot;, &quot;GS&quot;, &quot;CG&quot;, &quot;SHO&quot;, &quot;SV&quot;, &quot;IPouts&quot;, &quot;H_opp&quot;, &quot;ER&quot;, &quot;HR_opp&quot;, &quot;BB_opp&quot;, &quot;SO_opp&quot;, &quot;IBB_opp&quot;, &quot;WP&quot;, &quot;HBP_opp&quot;, &quot;BK&quot;, &quot;BFP&quot;, &quot;GF&quot;, &quot;R_opp&quot;, &quot;SH_opp&quot;, &quot;SF_opp&quot;, &quot;GIDP_opp&quot;, &quot;ERA&quot;, &quot;PO&quot;, &quot;A&quot;, &quot;E&quot;, &quot;ERPer&quot;]
</code></pre>
</div>
</div>
<div id="dd09ffe9" class="cell code" data-execution_count="651">
<div class="sourceCode" id="cb21"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>, <span class="bu">PrettyTables</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>corcol <span class="op">=</span> <span class="fu">DataFrame</span>(<span class="fu">cor</span>(<span class="fu">Matrix</span>(df[!, <span class="fu">names</span>(df)[<span class="fl">3</span><span class="op">:</span><span class="fl">44</span>]])), <span class="fu">names</span>(df)[<span class="fl">3</span><span class="op">:</span><span class="fl">44</span>])</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>corcol[!, <span class="st">&quot;names&quot;</span>] <span class="op">.=</span> <span class="fu">names</span>(df)[<span class="fl">3</span><span class="op">:</span><span class="fl">44</span>]</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>corcol <span class="op">=</span> <span class="fu">select</span>(corcol, [<span class="st">&quot;W&quot;</span>, <span class="st">&quot;names&quot;</span>])</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pretty_table</span>(corcol)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#CSV.write(&quot;/Users/jackmerchen/Data/Baseball_Correlation.csv&quot;, corcol)</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>┌─────────────┬──────────┐
│           W │    names │
│     Float64 │   String │
├─────────────┼──────────┤
│    0.359469 │       AB │
│      0.5733 │        R │
│    0.464624 │        H │
│    0.291058 │       2B │
│   0.0688821 │       3B │
│    0.367797 │       HR │
│    0.558646 │      RBI │
│    0.130276 │       SB │
│  -0.0360671 │       CS │
│    0.447807 │       BB │
│    0.044199 │       SO │
│    0.294955 │      IBB │
│    0.164847 │      HBP │
│ 0.000623552 │       SH │
│    0.330824 │       SF │
│   0.0946829 │     GIDP │
│    0.372947 │      Ave │
│     0.48304 │       TB │
│         1.0 │        W │
│   0.0333526 │        G │
│    0.321102 │       GS │
│   0.0885294 │       CG │
│     0.18468 │      SHO │
│    0.541299 │       SV │
│    0.396228 │   IPouts │
│   -0.163725 │    H_opp │
│   -0.334127 │       ER │
│    -0.10577 │   HR_opp │
│   -0.272925 │   BB_opp │
│    0.270528 │   SO_opp │
│   -0.171621 │  IBB_opp │
│   -0.134226 │       WP │
│  -0.0592108 │  HBP_opp │
│  -0.0723258 │       BK │
│    0.134821 │      BFP │
│   0.0518899 │       GF │
│   -0.367298 │    R_opp │
│  -0.0912082 │   SH_opp │
│   -0.169021 │   SF_opp │
│ -0.00136654 │ GIDP_opp │
│   -0.464193 │      ERA │
│    0.396026 │       PO │
└─────────────┴──────────┘
</code></pre>
</div>
</div>
</body>
</html>
